syntax = "proto3";

package marksman.api.v1;

option go_package = "github.com/aide-family/marksman/pkg/api/v1;v1";
option java_multiple_files = true;
option java_package = "marksman.api.v1";

import "google/api/annotations.proto";
import "buf/validate/validate.proto";
import "magicbox/enum/enum.proto";

service Level {
	rpc CreateLevel (CreateLevelRequest) returns (CreateLevelReply) {
		option (google.api.http) = {
			post: "/v1/level"
			body: "*"
		};
	}
	rpc UpdateLevel (UpdateLevelRequest) returns (UpdateLevelReply) {
		option (google.api.http) = {
			put: "/v1/level/{uid}"
			body: "*"
		};
	}
	rpc UpdateLevelStatus (UpdateLevelStatusRequest) returns (UpdateLevelStatusReply) {
		option (google.api.http) = {
			put: "/v1/level/{uid}/status"
			body: "*"
		};
	}
	rpc DeleteLevel (DeleteLevelRequest) returns (DeleteLevelReply) {
		option (google.api.http) = {
			delete: "/v1/level/{uid}"
		};
	}
	rpc GetLevel (GetLevelRequest) returns (LevelItem) {
		option (google.api.http) = {
			get: "/v1/level/{uid}"
		};
	}
	rpc ListLevel (ListLevelRequest) returns (ListLevelReply) {
		option (google.api.http) = {
			get: "/v1/levels"
		};
	}
	rpc SelectLevel (SelectLevelRequest) returns (SelectLevelReply) {
		option (google.api.http) = {
			get: "/v1/levels/select"
		};
	}
}

message LevelItem {
	int64 uid = 1;
	string name = 2;
	string remark = 3;
	magicbox.enum.GlobalStatus status = 4;
	map<string, string> metadata = 5;
	string createdAt = 6;
	string updatedAt = 7;
}

message LevelItemSelect {
	int64 value = 1;
	string label = 2;
	bool disabled = 3;
	string tooltip = 4;
}

message CreateLevelRequest {
	string name = 1 [(buf.validate.field).required = true, (buf.validate.field).string = {
		min_len: 3,
		max_len: 100,
	}];
	string remark = 2;
	map<string, string> metadata = 3;
}
message CreateLevelReply {}

message UpdateLevelRequest {
	int64 uid = 1 [(buf.validate.field).required = true, (buf.validate.field).cel = {
		expression: "this > 0",
		message: "uid must be greater than 0",
	}];
	string name = 2 [(buf.validate.field).required = true, (buf.validate.field).string = {
		min_len: 3,
		max_len: 100,
	}];
	string remark = 3;
	map<string, string> metadata = 4;
}
message UpdateLevelReply {}

message UpdateLevelStatusRequest {
	int64 uid = 1 [(buf.validate.field).required = true];
	magicbox.enum.GlobalStatus status = 2 [(buf.validate.field).required = true, (buf.validate.field).cel = {
		expression: "this in [magicbox.enum.GlobalStatus.ENABLED, magicbox.enum.GlobalStatus.DISABLED]",
		message: "status must be in ['ENABLED', 'DISABLED']",
	}];
}
message UpdateLevelStatusReply {}

message DeleteLevelRequest {
	int64 uid = 1 [(buf.validate.field).required = true];
}
message DeleteLevelReply {}

message GetLevelRequest {
	int64 uid = 1 [(buf.validate.field).required = true];
}

message ListLevelRequest {
	int32 page = 1 [(buf.validate.field).required = true, (buf.validate.field).cel = {
		expression: "this >= 1",
		message: "page must be greater than or equal to 1",
	}];
	int32 pageSize = 2 [(buf.validate.field).required = true, (buf.validate.field).cel = {
		expression: "this >= 1 && this <= 200",
		message: "pageSize must be greater than or equal to 1 and less than or equal to 200",
	}];
	string keyword = 3 [(buf.validate.field).cel = {
		expression: "this.size() <= 100",
		message: "keyword must be less than or equal to 100",
	}];
	magicbox.enum.GlobalStatus status = 4;
}
message ListLevelReply {
	int64 total = 1;
	int32 page = 2;
	int32 pageSize = 3;
	repeated LevelItem items = 4;
}

message SelectLevelRequest {
	string keyword = 1 [(buf.validate.field).cel = {
		expression: "this.size() <= 100",
		message: "keyword must be less than or equal to 100",
	}];
	int32 limit = 2 [(buf.validate.field).required = true, (buf.validate.field).cel = {
		expression: "this >= 1 && this <= 100",
		message: "limit must be greater than or equal to 1 and less than or equal to 100",
	}];
	int64 lastUID = 3;
	magicbox.enum.GlobalStatus status = 4;
}
message SelectLevelReply {
	repeated LevelItemSelect items = 1;
	int64 total = 2;
	int64 lastUID = 3;
	bool hasMore = 4;
}