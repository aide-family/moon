# Moon é¡¹ç›®ä»‹ç»ä¸å…¥é—¨æ‰‹å†Œ

<div style="display: flex; align-items: center;">
  <img 
    src="./docs/images/logo.svg" 
    alt="Logo" 
    style="height: 4em; width: auto; vertical-align: middle; margin-right: 10px;" 
  />
  <h1 style="margin: 0; font-size: 24px; line-height: 1.5;">Moon - å¤šé¢†åŸŸç›‘æ§å‘Šè­¦å¹³å°</h1>
</div>

## ğŸŒŸ é¡¹ç›®æ¦‚è¿°

Moon æ˜¯ä¸€ä¸ªä¸ºç°ä»£æŠ€æœ¯æ ˆè®¾è®¡çš„ç›‘æ§å’Œå‘Šè­¦å¹³å°ï¼Œä¸“ä¸ºäº‘åŸç”Ÿã€ç‰©è”ç½‘ï¼ˆIoTï¼‰å’Œäººå·¥æ™ºèƒ½ï¼ˆAIï¼‰åº”ç”¨æä¾›å…¨é¢çš„ç›‘æ§è§£å†³æ–¹æ¡ˆã€‚å®ƒé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼ŒåŸºäº Go è¯­è¨€å¼€å‘ï¼Œä½¿ç”¨ Kratos æ¡†æ¶æ„å»ºã€‚

### è®¾è®¡ç†å¿µ
- **ç®€å• (Simple)**: ç®€åŒ–ç›‘æ§è¿ç»´æ“ä½œ
- **æ™ºèƒ½ (Smart)**: å†…ç½® AI ç®—æ³•æ”¯æŒå¼‚å¸¸æ£€æµ‹å’Œè¶‹åŠ¿é¢„æµ‹
- **é«˜æ•ˆ (Efficient)**: ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’Œé«˜å¯è§‚æµ‹æ€§

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

Moon é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œç”±å››ä¸ªæ ¸å¿ƒæœåŠ¡ç»„æˆï¼š

### æ ¸å¿ƒæœåŠ¡æ¶æ„å›¾

```mermaid
graph TB
    subgraph "Moon ç›‘æ§å¹³å°"
        Palace[Palace - æ ¸å¿ƒç®¡ç†æœåŠ¡]
        Houyi[Houyi - ç›‘æ§å¼•æ“]
        Rabbit[Rabbit - é€šçŸ¥æœåŠ¡]
        Laurel[Laurel - æŒ‡æ ‡é‡‡é›†]
    end
    
    subgraph "å¤–éƒ¨ä¾èµ–"
        DB[(MySQL/PostgreSQL)]
        Cache[(Redis)]
        Registry[æœåŠ¡æ³¨å†Œä¸­å¿ƒ]
        Prometheus[Prometheus/VictoriaMetrics]
    end
    
    subgraph "ç›‘æ§ç›®æ ‡"
        K8s[Kubernetes]
        Docker[Docker]
        IoT[IoTè®¾å¤‡]
        Apps[åº”ç”¨æœåŠ¡]
    end
    
    Palace --> DB
    Palace --> Cache
    Palace --> Registry
    
    Houyi --> Prometheus
    Houyi --> Palace
    
    Rabbit --> Palace
    
    Laurel --> Apps
    Laurel --> K8s
    Laurel --> IoT
    Laurel --> Palace
    
    Palace -.-> Houyi
    Palace -.-> Rabbit
    Palace -.-> Laurel
```

### 1. Palace (æ ¸å¿ƒç®¡ç†æœåŠ¡) ğŸ°

**å®šä½**: ç³»ç»Ÿçš„ç®¡ç†ä¸­å¿ƒå’Œæ§åˆ¶å¹³é¢
- **ä¸»è¦åŠŸèƒ½**:
  - ç”¨æˆ·è®¤è¯ä¸æˆæƒç®¡ç†
  - å›¢é˜Ÿå’Œæƒé™ç®¡ç†
  - ç›‘æ§ç­–ç•¥é…ç½®
  - æ•°æ®æºç®¡ç†
  - ä»ªè¡¨æ¿é…ç½®
  - ç³»ç»Ÿé…ç½®ç®¡ç†
- **æŠ€æœ¯ç‰¹ç‚¹**:
  - å¤šç§Ÿæˆ·æ¶æ„æ”¯æŒ
  - åŠ¨æ€æ•°æ®åº“é…ç½®
  - æœåŠ¡é—´é€šä¿¡åè°ƒ
  - RESTful API å’Œ gRPC åŒåè®®æ”¯æŒ

### 2. Houyi (ç›‘æ§å¼•æ“) ğŸ¹

**å®šä½**: å®æ—¶ç›‘æ§å’Œå‘Šè­¦è¯„ä¼°å¼•æ“
- **ä¸»è¦åŠŸèƒ½**:
  - å®æ—¶æŒ‡æ ‡è¯„ä¼°
  - å‘Šè­¦è§„åˆ™æ‰§è¡Œ
  - æ—¶é—´åºåˆ—æ•°æ®å¤„ç†
  - å¼‚å¸¸æ£€æµ‹ç®—æ³•
  - å‘Šè­¦äº‹ä»¶ç”Ÿæˆ
- **æŠ€æœ¯ç‰¹ç‚¹**:
  - æ”¯æŒå¤šç§æ•°æ®æº (Prometheusã€VictoriaMetrics)
  - é«˜æ€§èƒ½æ—¶é—´åºåˆ—è®¡ç®—
  - æ’ä»¶åŒ–çš„è¯„ä¼°å¼•æ“
  - åˆ†å¸ƒå¼å‘Šè­¦å¤„ç†

### 3. Rabbit (é€šçŸ¥æœåŠ¡) ğŸ°

**å®šä½**: å¤šæ¸ é“é€šçŸ¥å’Œæ¶ˆæ¯åˆ†å‘æœåŠ¡
- **ä¸»è¦åŠŸèƒ½**:
  - é‚®ä»¶é€šçŸ¥å‘é€
  - çŸ­ä¿¡é€šçŸ¥å‘é€
  - Webhook é›†æˆ
  - æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†
  - é€šçŸ¥æ¨¡æ¿ç®¡ç†
- **æŠ€æœ¯ç‰¹ç‚¹**:
  - å¤šé€šé“æ¶ˆæ¯å‘é€
  - æ¶ˆæ¯å»é‡å’Œé™æµ
  - æ¨¡æ¿åŒ–æ¶ˆæ¯å†…å®¹
  - å¼‚æ­¥æ¶ˆæ¯å¤„ç†

### 4. Laurel (æŒ‡æ ‡é‡‡é›†) ğŸƒ

**å®šä½**: æŒ‡æ ‡é‡‡é›†å’Œè„šæœ¬æ‰§è¡ŒæœåŠ¡
- **ä¸»è¦åŠŸèƒ½**:
  - è‡ªå®šä¹‰è„šæœ¬æ‰§è¡Œ
  - æŒ‡æ ‡æ•°æ®é‡‡é›†
  - å¤šè¯­è¨€è„šæœ¬æ”¯æŒ (Pythonã€Shellã€Bash)
  - å®šæ—¶ä»»åŠ¡è°ƒåº¦
- **æŠ€æœ¯ç‰¹ç‚¹**:
  - çµæ´»çš„è„šæœ¬å‘½åçº¦å®š
  - å¤šè§£é‡Šå™¨æ”¯æŒ
  - JSON æ ¼å¼æ•°æ®è¾“å‡º
  - å®šæ—¶é—´éš”é…ç½®

## ğŸ”§ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **è¯­è¨€**: Go 1.21+
- **æ¡†æ¶**: Kratos v2 (å¾®æœåŠ¡æ¡†æ¶)
- **API**: Protocol Buffers + gRPC/HTTP
- **æ•°æ®åº“**: MySQL/PostgreSQL + GORM
- **ç¼“å­˜**: Redis
- **æœåŠ¡å‘ç°**: Consul/Etcd
- **ç›‘æ§**: Prometheus/VictoriaMetrics

### å¼€å‘å·¥å…·
- **ä¾èµ–æ³¨å…¥**: Google Wire
- **ä»£ç ç”Ÿæˆ**: protoc-gen-*
- **æ„å»ºå·¥å…·**: Make
- **å®¹å™¨åŒ–**: Docker
- **ç¼–æ’**: Kubernetes

### é¡¹ç›®ç»“æ„
```
moon/
â”œâ”€â”€ cmd/                    # å¾®æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ palace/            # ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ houyi/             # ç›‘æ§å¼•æ“
â”‚   â”œâ”€â”€ rabbit/            # é€šçŸ¥æœåŠ¡
â”‚   â””â”€â”€ laurel/            # æŒ‡æ ‡é‡‡é›†
â”œâ”€â”€ pkg/                   # å…±äº«åŒ…
â”‚   â”œâ”€â”€ api/              # API å®šä¹‰
â”‚   â”œâ”€â”€ plugin/           # æ’ä»¶ç³»ç»Ÿ
â”‚   â””â”€â”€ util/             # å·¥å…·å‡½æ•°
â”œâ”€â”€ proto/                 # Protocol Buffers å®šä¹‰
â”œâ”€â”€ deploy/               # éƒ¨ç½²é…ç½®
â”œâ”€â”€ scripts/              # è„šæœ¬æ–‡ä»¶
â””â”€â”€ i18n/                 # å›½é™…åŒ–
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

1. **å¼€å‘ç¯å¢ƒ**:
   ```bash
   # Go ç‰ˆæœ¬è¦æ±‚
   go version >= 1.21
   
   # å®‰è£…å¿…è¦å·¥å…·
   make init
   ```

2. **åŸºç¡€è®¾æ–½**:
   ```bash
   # å¯åŠ¨ä¾èµ–æœåŠ¡
   cd deploy
   
   # å¯åŠ¨ MySQL
   docker-compose -f mysql/docker-compose.yml up -d
   
   # å¯åŠ¨ Redis
   docker-compose -f redis/docker-compose.yml up -d
   
   # å¯åŠ¨ Etcd (æœåŠ¡æ³¨å†Œ)
   docker-compose -f etcd/docker-compose.yml up -d
   
   # å¯åŠ¨ Prometheus (å¯é€‰)
   docker-compose -f prometheus/docker-compose.yml up -d
   ```

### æœ¬åœ°å¼€å‘

1. **åˆå§‹åŒ–é¡¹ç›®**:
   ```bash
   # ç”Ÿæˆæ‰€æœ‰ä»£ç 
   make all
   ```

2. **å¯åŠ¨æœåŠ¡**:
   ```bash
   # å¯åŠ¨ Palace (ç®¡ç†æœåŠ¡)
   make run app=palace
   
   # å¯åŠ¨ Houyi (ç›‘æ§å¼•æ“)
   make run app=houyi
   
   # å¯åŠ¨ Rabbit (é€šçŸ¥æœåŠ¡)
   make run app=rabbit
   
   # å¯åŠ¨ Laurel (æŒ‡æ ‡é‡‡é›†)
   make run app=laurel
   ```

3. **æ•°æ®åº“è¿ç§»**:
   ```bash
   # æ‰§è¡Œæ•°æ®åº“è¿ç§»
   make migrate-table app=palace
   ```

### é…ç½®è¯´æ˜

æ¯ä¸ªæœåŠ¡éƒ½æœ‰ç‹¬ç«‹çš„é…ç½®ç›®å½•ï¼š

```
cmd/{service}/config/
â”œâ”€â”€ config.yaml        # ä¸»é…ç½®
â”œâ”€â”€ server.yaml        # æœåŠ¡å™¨é…ç½®
â”œâ”€â”€ auth.yaml          # è®¤è¯é…ç½®
â”œâ”€â”€ log.yaml           # æ—¥å¿—é…ç½®
â””â”€â”€ i18n.yaml          # å›½é™…åŒ–é…ç½®
```

## ğŸ“– æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. ç›‘æ§ç­–ç•¥é…ç½®

é€šè¿‡ Palace æœåŠ¡é…ç½®ç›‘æ§ç­–ç•¥ï¼š
- å®šä¹‰ç›‘æ§æŒ‡æ ‡å’Œé˜ˆå€¼
- è®¾ç½®å‘Šè­¦è§„åˆ™å’Œæ¡ä»¶
- é…ç½®é€šçŸ¥æ¸ é“å’Œæ¥æ”¶äºº
- ç®¡ç†ç›‘æ§æ•°æ®æº

### 2. å®æ—¶ç›‘æ§è¯„ä¼°

Houyi æœåŠ¡æä¾›ï¼š
- å®æ—¶æŒ‡æ ‡æ•°æ®è¯„ä¼°
- å¤šç»´åº¦å‘Šè­¦è§¦å‘
- æ™ºèƒ½å¼‚å¸¸æ£€æµ‹
- å†å²æ•°æ®åˆ†æ

### 3. å¤šæ¸ é“é€šçŸ¥

Rabbit æœåŠ¡æ”¯æŒï¼š
- é‚®ä»¶é€šçŸ¥
- çŸ­ä¿¡é€šçŸ¥
- Webhook é›†æˆ
- è‡ªå®šä¹‰é€šçŸ¥æ¨¡æ¿

### 4. è‡ªå®šä¹‰æŒ‡æ ‡é‡‡é›†

Laurel æœåŠ¡å®ç°ï¼š
- è„šæœ¬åŒ–æŒ‡æ ‡é‡‡é›†
- å¤šè¯­è¨€æ”¯æŒ
- çµæ´»çš„æ‰§è¡Œè°ƒåº¦
- æ ‡å‡†åŒ–æ•°æ®è¾“å‡º

### è„šæœ¬å‘½åçº¦å®š

Laurel ä½¿ç”¨ç‰¹æ®Šçš„æ–‡ä»¶å‘½åçº¦å®šæ¥è¯†åˆ«è„šæœ¬ï¼š

```
{æ‰§è¡Œé—´éš”}_{è§£é‡Šå™¨ç±»å‹}_{è„šæœ¬åç§°}.{æ‰©å±•å}
```

ç¤ºä¾‹ï¼š
- `5s_bash_hello.sh` - æ¯5ç§’æ‰§è¡Œçš„Bashè„šæœ¬
- `10s_python3_hello3.py` - æ¯10ç§’æ‰§è¡Œçš„Python3è„šæœ¬
- `1m_sh_system_metrics.sh` - æ¯åˆ†é’Ÿæ‰§è¡Œçš„Shellè„šæœ¬

## ğŸ”„ DDD åˆ†å±‚æ¶æ„

é¡¹ç›®é‡‡ç”¨ mini DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰æ¶æ„ï¼š

```
service -> biz -> repository -> impl -> data
```

### åˆ†å±‚è¯´æ˜

1. **API å±‚**: æ¥å£å®šä¹‰ï¼ˆproto/pbï¼‰
2. **Service å±‚**: æœåŠ¡å…¥å£ï¼Œå‚æ•°æ ¡éªŒå’Œè½¬æ¢
3. **Biz å±‚**: ä¸šåŠ¡é€»è¾‘å®ç°
   - bo: ä¸šåŠ¡å¯¹è±¡
   - do: æ•°æ®å¯¹è±¡
   - repository: ä»“å‚¨æ¥å£
   - vobj: å€¼å¯¹è±¡
4. **Data å±‚**: æ•°æ®è®¿é—®å’Œå¤–éƒ¨æœåŠ¡

### æ•°æ®æµè½¬

```mermaid
graph LR
    A[HTTP/gRPC Request] --> B[Service Layer]
    B --> C[Biz Layer]
    C --> D[Repository Interface]
    D --> E[Impl Layer]
    E --> F[Data Layer]
    F --> G[Database/External API]
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. **å®šä¹‰ API**:
   ```bash
   # åœ¨ proto/api/{service}/ ç›®å½•ä¸‹æ·»åŠ  .proto æ–‡ä»¶
   # ç”Ÿæˆä»£ç 
   make api app={service}
   ```

2. **å®ç°ä¸šåŠ¡é€»è¾‘**:
   ```bash
   # åœ¨ cmd/{service}/internal/biz/ ä¸‹å®ç°ä¸šåŠ¡é€»è¾‘
   # åœ¨ cmd/{service}/internal/service/ ä¸‹å®ç°æœåŠ¡å±‚
   ```

3. **æ•°æ®è®¿é—®å±‚**:
   ```bash
   # åœ¨ cmd/{service}/internal/data/ ä¸‹å®ç°æ•°æ®è®¿é—®
   ```

4. **ä¾èµ–æ³¨å…¥**:
   ```bash
   # æ›´æ–° provider_set.go æ–‡ä»¶
   # é‡æ–°ç”Ÿæˆ wire
   make wire-{service}
   ```

### æµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
go test ./...

# è¿è¡Œç‰¹å®šæœåŠ¡æµ‹è¯•
go test ./cmd/{service}/...
```

### æ„å»ºå’Œéƒ¨ç½²

```bash
# æ„å»ºæœåŠ¡
make build app={service}

# æ„å»º Docker é•œåƒ
make docker-build app={service}

# ä½¿ç”¨ Kubernetes éƒ¨ç½²
kubectl apply -f deploy/
```

## ğŸ“Š ç›‘æ§å’Œè§‚æµ‹

### å†…ç½®ç›‘æ§

- **æœåŠ¡å¥åº·æ£€æŸ¥**: æ¯ä¸ªæœåŠ¡éƒ½æä¾›å¥åº·æ£€æŸ¥ç«¯ç‚¹
- **æŒ‡æ ‡æ”¶é›†**: å†…ç½® Prometheus æŒ‡æ ‡
- **é“¾è·¯è¿½è¸ª**: æ”¯æŒ OpenTelemetry
- **æ—¥å¿—è®°å½•**: ç»“æ„åŒ–æ—¥å¿—è¾“å‡º

### ç›‘æ§æŒ‡æ ‡

- æœåŠ¡å¯ç”¨æ€§å’Œå“åº”æ—¶é—´
- ä¸šåŠ¡æŒ‡æ ‡å’Œå‘Šè­¦æ•°é‡
- ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
- æ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢æ€§èƒ½

## ğŸŒ å›½é™…åŒ–æ”¯æŒ

Moon æ”¯æŒå¤šè¯­è¨€ï¼š
- ä¸­æ–‡ (zh)
- è‹±æ–‡ (en)
- æ—¥æ–‡ (ja)

é…ç½®æ–‡ä»¶ä½äº `i18n/` ç›®å½•ä¸‹ã€‚

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
make docker-build app=palace
make docker-build app=houyi
make docker-build app=rabbit
make docker-build app=laurel

# ä½¿ç”¨ docker-compose éƒ¨ç½²
docker-compose up -d
```

### Kubernetes éƒ¨ç½²

```bash
# éƒ¨ç½²åˆ° K8s é›†ç¾¤
kubectl apply -f deploy/k8s/
```

### é…ç½®å»ºè®®

1. **æ•°æ®åº“é…ç½®**: 
   - ä½¿ç”¨è¯»å†™åˆ†ç¦»
   - é…ç½®è¿æ¥æ± 
   - å¯ç”¨æ•°æ®åº“ç›‘æ§

2. **ç¼“å­˜é…ç½®**:
   - Redis é›†ç¾¤æ¨¡å¼
   - é€‚å½“çš„è¿‡æœŸç­–ç•¥
   - ç›‘æ§å†…å­˜ä½¿ç”¨

3. **æœåŠ¡é…ç½®**:
   - åˆç†çš„è¶…æ—¶è®¾ç½®
   - é™æµå’Œç†”æ–­é…ç½®
   - å¥åº·æ£€æŸ¥é…ç½®

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. **é˜…è¯»æ–‡æ¡£**: 
   - [GOPHER.md](./docs/dev/GOPHER.md)
   - [DEV.md](./docs/dev/DEV.md)
   - [COMMIT.md](./docs/dev/COMMIT.md)

2. **æäº¤é—®é¢˜**: åœ¨ [Issues](https://github.com/aide-family/moon/issues) ä¸­æäº¤

3. **ä»£ç è´¡çŒ®**: 
   - Fork é¡¹ç›®
   - åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
   - æäº¤ Pull Request
   - ç¡®ä¿é€šè¿‡æ‰€æœ‰æµ‹è¯•

4. **ä»£ç è§„èŒƒ**:
   - éµå¾ª Go è¯­è¨€è§„èŒƒ
   - æ·»åŠ å¿…è¦çš„æ³¨é‡Š
   - ç¼–å†™å•å…ƒæµ‹è¯•
   - æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“ ç¤¾åŒºæ”¯æŒ

- **GitHub**: [https://github.com/aide-family/moon](https://github.com/aide-family/moon)
- **æ–‡æ¡£**: [https://aide-family.github.io](https://aide-family.github.io)
- **è®ºå›**: [GitHub Discussions](https://github.com/aide-family/moon/discussions)
- **Discord**: [åŠ å…¥æˆ‘ä»¬](https://discord.gg/rQT7psPESG)
- **é£ä¹¦ç¾¤**: [å¼€å‘è€…ç¾¤](https://applink.feishu.cn/client/chat/chatter/add_by_link?link_token=386t3219-195d-4e4d-a11c-0f1bbcb1d705)

## ğŸ“„ è®¸å¯è¯

Moon åŸºäº [MIT è®¸å¯è¯](LICENSE) å¼€æºï¼Œæ‚¨å¯ä»¥è‡ªç”±ä½¿ç”¨å’Œä¿®æ”¹ã€‚

---

**Moon - ç®€åŒ–ç›‘æ§ï¼Œèµ‹èƒ½è¿ç»´ã€‚**

æ„Ÿè°¢æ‚¨å¯¹ Moon é¡¹ç›®çš„å…³æ³¨å’Œæ”¯æŒï¼å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä¸Šè¿°æ¸ é“ä¸æˆ‘ä»¬è”ç³»ã€‚